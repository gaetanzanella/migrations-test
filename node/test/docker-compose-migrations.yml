version: '3.7'

services:
  database:
    image: mysql:5.7
    container_name: migrations-test-mysql
    command: --default-authentication-plugin=mysql_native_password
    environment:
       MYSQL_USER: user
       MYSQL_PASSWORD: password
       MYSQL_ROOT_PASSWORD: password
       MYSQL_DATABASE: migrations-test
    ports:
      - 13306:3306
  app:
    image: node:12.14.1
    container_name: migrations-test-app
    ports:
     - 8002:9000
    links:
    - database
    environment:
        DB_HOST: database
        DB_PORT: 3306
        DB_USER: user
        DB_PASSWORD: password
        NODE_ENV: production
    working_dir: /app/dist
    command: node index.js
    volumes:
      - ../../../:/app:ro
